# Rakubun AI コンテンツジェネレーター - 機能ドキュメント

## 概要

Rakubun AI コンテンツジェネレーターは、最新のAI技術（GPT-4、DALL-E 3）を活用して、高品質な記事と画像を効率的に生成するための包括的なWordPressプラグインです。外部ダッシュボード（app.rakubun.com）で一元管理され、セキュアで安全な運用を実現します。

## コア機能

### 1. AI記事生成

**技術**: OpenAI GPT-4

**機能**:
- 複雑に構成された、プロフェッショナルな記事を自動生成
- カスタマイズ可能なプロンプトで特定のニーズに対応
- 自動的にWordPress下書き投稿を作成
- コンテンツ長の最適化（1記事あたり最大2000トークン）
- トーンとスタイルの一貫性を維持

**使用例**:
- ブログ記事
- 商品説明
- ハウツーガイド
- ニュース記事
- 教育コンテンツ

**動作フロー**:
1. ユーザーが希望する記事について詳しいプロンプトを入力
2. オプション：カスタムタイトルを指定
3. プラグインがGPT-4にOpenAI API経由でリクエストを送信
4. 生成された記事がインターフェースに表示
5. オプション：WordPressドラフト投稿を自動作成
6. ユーザーがコンテンツをコピーするか、作成された投稿を利用

### 2. AI画像生成

**技術**: OpenAI DALL-E 3

**機能**:
- テキスト説明から独自の高品質画像を生成
- 3つのサイズオプション：
  - 正方形: 1024x1024（標準）
  - 縦長: 1024x1792（垂直）
  - 横長: 1792x1024（水平）
- WordPressメディアライブラリへの自動統合
- アイキャッチ画像やサムネイル用の高品質出力

**使用例**:
- ブログ記事のアイキャッチ画像
- 記事サムネイル
- ソーシャルメディア画像
- 商品モックアップ
- イラストのコンセプト

**動作フロー**:
1. ユーザーが画像の詳しい説明を提供
2. ユーザーが希望する画像サイズを選択
3. プラグインがDALL-E 3に画像生成をリクエスト
4. 生成された画像が表示
5. オプション：WordPressメディアライブラリに保存
6. 投稿のアイキャッチ画像として使用可能

### 3. 自動リライト機能

**技術**: OpenAI GPT-4

**機能**:
- 既存の投稿を自動的にAIで改善・リライト
- 記事の品質向上とSEO最適化
- スケジュール機能で定期的な自動リライト
- リライト前後の比較情報を記録
- 改善度合いを可視化（文字数変化、SEO改善度など）

**リライト内容**:
- 文体と表現の改善
- キーワード最適化
- 文章構造の整理
- 可読性の向上
- SEO親和性の向上

**スケジュール設定**:
- 曜日ごとのスケジュール（月～日）
- リライト対象となる記事数
- 自動投稿または下書き保存のオプション

### 4. クレジットシステム

**無料クレジット**:
- ユーザーあたり記事生成クレジット：3個
- ユーザーあたり画像生成クレジット：5個
- リライト用の独立したクレジット（初回時に付与）

**クレジット管理**:
- リアルタイムなクレジット残高表示
- 記事と画像の個別トラッキング
- 生成成功時にクレジット自動消費
- 購入履歴の追跡
- 監査目的でのトランザクションログ

**データベース保存**:
- ユーザークレジットテーブルで残高をトラッキング
- トランザクションテーブルで支払い履歴を記録
- 生成コンテンツテーブルで履歴を管理

### 5. 決済連携

**技術**: Stripe

**機能**:
- 安全な支払い処理
- PCI準拠のクレジットカード処理
- 開発用テストモード
- 本番用ライブモード
- クレジット即座配信
- トランザクション検証

**支払いフロー**:
1. ユーザーがクレジットパッケージを選択
2. Stripe決済フォームが表示
3. サーバー側で支払いインテント（Payment Intent）を作成
4. Stripe.js経由でカード情報を安全に処理（サーバーに到達しない）
5. 支払い確認
6. クレジットがユーザーアカウントに自動追加
7. トランザクションが記録

**価格設定**:
- パッケージ価格のカスタマイズ可能
- パッケージあたりのクレジット数を調整
- 記事と画像で異なる価格を設定可能

### 6. 外部ダッシュボード統合

**ダッシュボード機能**: app.rakubun.com

**一元管理される項目**:
- OpenAI APIキー設定（記事、画像、リライト用）
- Stripe APIキーの安全な管理
- クレジット価格パッケージ設定
- ユーザークレジット残高管理
- 全サイトの統計・分析情報
- 複数サイト運用の一元管理

**利点**:
- APIキーをローカルに保存しない完全なセキュリティ
- 複数のWordPressサイトを単一ダッシュボードで管理
- リアルタイムな価格調整が全サイトに反映
- 一元化された分析とレポート

### 7. WordPress統合

**管理ダッシュボード**:
- 直感的なインターフェース
- クレジット残高の概要表示
- クイックアクションボタン
- 使用統計表示

**投稿作成機能**:
- 記事からの自動下書き投稿作成
- タイトルとコンテンツを自動入力
- 編集・公開の準備完了状態
- ユーザー作成者情報を保持

**メディアライブラリ統合**:
- 生成画像を自動保存
- 適切なファイル名付け
- 標準的なWordPress添付ファイル処理
- WordPress全体で使用可能

**ユーザー管理**:
- ユーザーごとのクレジット追跡
- ユーザー権限チェック
- 作成者情報の帰属
- アクティビティログ

### 8. セキュリティ機能

**入力検証**:
- すべてのユーザー入力をサニタイズ
- パラメータの型検証
- 重要な値のホワイトリスト検証
- XSS対策

**データベースセキュリティ**:
- 準備されたSQL文の使用
- 動的カラム名を使わない（値の検証時を除く）
- 適切なエスケープ
- 安全なデータ保存

**API セキュリティ**:
- 外部ダッシュボードでのAPIキー安全管理
- キーはフロントエンドに露出しない
- 適切な認証ヘッダー
- セキュアな通信チャネル

**決済セキュリティ**:
- Stripeでクレジットカード情報を処理（PCI準拠）
- サーバー側での支払い検証
- Payment Intent IDの検証
- メタデータ検証
- ユーザー認証必須

**WordPress セキュリティ**:
- すべてのAJAXリクエストでノンス（nonce）検証
- ユーザー権限チェック
- 直接アクセス防止
- 適切なフック使用

### 9. エラーハンドリング

**ユーザー向けメッセージ**:
- 明確なエラー説明
- 実行可能なフィードバック
- 技術的な内容を避けた表現

**API エラー処理**:
- OpenAI APIエラーのキャッチと報告
- Stripe支払い失敗の適切な処理
- ネットワークタイムアウト管理
- レート制限への対応

**検証エラー**:
- 空のプロンプト検出
- クレジット不足通知
- 無効な設定アラート
- APIキー未設定警告

## 技術仕様

### システム要件

- **WordPress**: 5.0以上
- **PHP**: 7.4以上
- **MySQL**: 5.6以上
- **HTTPS**: 本番環境では推奨

### API要件

- **OpenAI**: アクティブなアカウント、APIキー、クレジット
- **Stripe**: アカウント（テストまたはライブキー）

### データベーステーブル

1. **wp_rakubun_user_credits**
   - ユーザーのクレジット残高を保存
   - 記事、画像、リライトクレジット数
   - 生成・購入時に更新

2. **wp_rakubun_transactions**
   - すべての購入を記録
   - 支払い金額とクレジットタイプを追跡
   - タイムスタンプと決済情報

3. **wp_rakubun_generated_content**
   - 生成されたコンテンツをアーカイブ
   - プロンプト情報を参照用に保存
   - 生成タイムスタンプ

### パフォーマンス考慮

**生成時間**:
- 記事: 30～60秒（GPT-4）
- 画像: 20～40秒（DALL-E 3）
- リライト: 20～45秒（GPT-4）

**サーバー要件**:
- PHP実行時間: 120秒以上推奨
- メモリ: 128MB以上推奨
- 安定したインターネット接続

**API制限**:
- OpenAIレート制限の尊重
- 必要に応じてリクエストをキュー
- レート制限時のエラーメッセージ表示

## ユーザーロールと権限

### コンテンツ作成者（edit_posts 権限）
- 記事生成
- 画像生成
- クレジット購入
- 自分のクレジット残高表示
- 生成インターフェースへのアクセス

### 管理者（manage_options 権限）
- すべてのコンテンツ作成者の権限
- ダッシュボード登録管理
- ダッシュボード連携確認
- すべてのトランザクション表示
- プラグイン設定へのアクセス

## 拡張性

### 利用可能なフック

プラグインは以下のWordPressフックを使用：

- プラグイン有効化時フック
- プラグイン無効化時フック
- AJAX操作用フック
- 管理メニューフック

### フィルタ機会

今後拡張可能な項目：
- クレジット数フィルタ
- 価格フィルタ
- コンテンツ出力フィルタ
- 生成パラメータフィルタ

## 制限事項

### OpenAI の制限

- OpenAIのコンテンツポリシーに準拠が必要
- アクティブなOpenAIアカウントとクレジットが必要
- レート制限が適用
- 一部のプロンプトは拒否される可能性

### Stripe の制限

- Stripeアカウントが必要
- 支払い処理手数料が発生
- 国による利用可否の違い
- 一部のカードタイプは使用不可

### WordPress の制限

- WordPressの環境が必要
- PHPバージョンに依存
- MySQLが必要
- セットアップに管理者アクセスが必要

## 今後の拡張機能候補

- 複数のAIモデル選択
- バッチ生成機能
- コンテンツスケジューリング
- チーム間クレジット共有
- 高度な分析機能
- コンテンツテンプレート
- SEO最適化機能
- マルチ言語対応
- カスタムモデルのファインチューニング
- API レート制限の高度な処理
- 支払い用Webhook統合

---

**プラグインバージョン**: 2.1.0
**最終更新**: 2025年11月

## Support and Maintenance

### Regular Updates

- Security patches
- WordPress compatibility
- API version updates
- Bug fixes

### Documentation

- README for general info
- INSTALL for setup
- FEATURES for capabilities
- Code comments for developers

### Community

- GitHub repository for issues
- Code is open source (GPL-2.0+)
- Community contributions welcome
