extends ../base

block content
  .container-fluid
    // Header
    .row.mb-4
      .col-12
        .d-flex.justify-content-between.align-items-center
          h1.h3.mb-0 External Dashboard - WordPress Plugin Management
          .d-flex.gap-2
            button.btn.btn-primary#refreshData
              i.fas.fa-sync-alt.me-2
              | Refresh
            button.btn.btn-success(data-bs-toggle="modal" data-bs-target="#seedDataModal")
              i.fas.fa-database.me-2
              | Seed Data

    // Stats Cards
    .row.mb-4#statsRow
      .col-md-3
        .card.bg-primary.text-white
          .card-body
            .d-flex.justify-content-between
              div
                h6.card-title Total Sites
                h2.mb-0#totalSites 0
              .align-self-center
                i.fas.fa-globe.fa-2x.opacity-75
      .col-md-3
        .card.bg-success.text-white
          .card-body
            .d-flex.justify-content-between
              div
                h6.card-title Total Users
                h2.mb-0#totalUsers 0
              .align-self-center
                i.fas.fa-users.fa-2x.opacity-75
      .col-md-3
        .card.bg-info.text-white
          .card-body
            .d-flex.justify-content-between
              div
                h6.card-title Generations Today
                h2.mb-0#generationsToday 0
              .align-self-center
                i.fas.fa-robot.fa-2x.opacity-75
      .col-md-3
        .card.bg-warning.text-white
          .card-body
            .d-flex.justify-content-between
              div
                h6.card-title Credits Used Today
                h2.mb-0#creditsToday 0
              .align-self-center
                i.fas.fa-coins.fa-2x.opacity-75

    // Navigation Tabs
    .row.mb-4
      .col-12
        ul.nav.nav-tabs#dashboardTabs
          li.nav-item
            a.nav-link.active(href="#sites" data-bs-toggle="tab") 
              i.fas.fa-globe.me-2
              | Sites
          li.nav-item
            a.nav-link(href="#users" data-bs-toggle="tab")
              i.fas.fa-users.me-2
              | Users
          li.nav-item
            a.nav-link(href="#packages" data-bs-toggle="tab")
              i.fas.fa-box.me-2
              | Packages
          li.nav-item
            a.nav-link(href="#config" data-bs-toggle="tab")
              i.fas.fa-cog.me-2
              | Configuration
          li.nav-item
            a.nav-link(href="#analytics" data-bs-toggle="tab")
              i.fas.fa-chart-line.me-2
              | Analytics

    // Tab Content
    .tab-content
      // Sites Tab
      .tab-pane.fade.show.active#sites
        .card
          .card-header.d-flex.justify-content-between.align-items-center
            h5.mb-0 WordPress Sites
            .d-flex.gap-2
              input.form-control(type="text" placeholder="Search sites..." style="width: 250px")#siteSearch
              button.btn.btn-outline-primary#searchSites
                i.fas.fa-search
          .card-body
            .table-responsive
              table.table.table-hover#sitesTable
                thead
                  tr
                    th Site Title
                    th URL
                    th Admin Email
                    th Users
                    th Status
                    th Last Activity
                    th Actions
                tbody
                  tr
                    td(colspan="7").text-center Loading...

      // Users Tab
      .tab-pane.fade#users
        .card
          .card-header.d-flex.justify-content-between.align-items-center
            h5.mb-0 WordPress Users
            .d-flex.gap-2
              select.form-select(style="width: 200px")#siteFilter
                option(value="") All Sites
              input.form-control(type="text" placeholder="Search users..." style="width: 250px")#userSearch
              button.btn.btn-outline-primary#searchUsers
                i.fas.fa-search
          .card-body
            .table-responsive
              table.table.table-hover#usersTable
                thead
                  tr
                    th User Email
                    th Site
                    th Article Credits
                    th Image Credits
                    th Rewrite Credits
                    th Total Generations
                    th Actions
                tbody
                  tr
                    td(colspan="7").text-center Loading...

      // Packages Tab
      .tab-pane.fade#packages
        .card
          .card-header.d-flex.justify-content-between.align-items-center
            h5.mb-0 Credit Packages
            button.btn.btn-primary(data-bs-toggle="modal" data-bs-target="#packageModal")
              i.fas.fa-plus.me-2
              | Add Package
          .card-body
            .table-responsive
              table.table.table-hover#packagesTable
                thead
                  tr
                    th Package ID
                    th Name
                    th Type
                    th Credits
                    th Price
                    th Popular
                    th Status
                    th Actions
                tbody
                  tr
                    td(colspan="8").text-center Loading...

      // Configuration Tab
      .tab-pane.fade#config
        // Provider Selection Card
        .card.mb-4
          .card-header
            h5.mb-0 AI Provider Selection
          .card-body
            .alert.alert-info
              i.fas.fa-info-circle.me-2
              | Select and configure your preferred AI provider. You can switch providers at any time without redeploying code.
            
            .row
              .col-md-6
                .mb-3
                  label.form-label(for="providerSelect")
                    | Active Provider
                    span.text-danger *
                  select.form-select#providerSelect
                    option(value="") Select a provider...
                    option(value="openai") OpenAI
                    option(value="novita") Novita AI
              .col-md-6
                .mb-3
                  label.form-label Provider Information
                  .alert.alert-light.mb-0#providerInfo
                    p.mb-0 Select a provider to see details
            
            .row
              .col-12
                .mb-3
                  label.form-label Current Providers on This Site
                  div.list-group#activeProvidersList
                    a.list-group-item.list-group-item-action(href="#") Loading...

        // Provider Configuration Card
        .card.mb-4
          .card-header
            h5.mb-0 Provider Configuration
          .card-body
            form#providerConfigForm
              .row
                .col-md-6
                  .mb-3
                    label.form-label(for="providerApiKey")
                      | API Key
                      span.text-danger *
                    input.form-control(type="password" id="providerApiKey" placeholder="Enter API key for selected provider" required)
                    small.form-text.text-muted
                      | Your API key will be encrypted and stored securely

                .col-md-6
                  .mb-3
                    label.form-label(for="modelArticle")
                      | Article Model
                      span.text-danger *
                    select.form-select#modelArticle(required)
                      option(value="") Select article model...
                    small.form-text.text-muted#articleModelHelp

              .row
                .col-md-4
                  .mb-3
                    label.form-label(for="modelImage")
                      | Image Model
                      span.text-danger *
                    select.form-select#modelImage(required)
                      option(value="") Select image model...
                    small.form-text.text-muted#imageModelHelp

                .col-md-4
                  .mb-3
                    label.form-label(for="maxTokens") Max Tokens
                    input.form-control(type="number" id="maxTokens" min="100" max="8000" value="2000")
                    small.form-text.text-muted Provider-specific limits apply

                .col-md-4
                  .mb-3
                    label.form-label(for="temperature") Temperature
                    input.form-control(type="number" id="temperature" min="0" max="2" step="0.1" value="0.7")
                    small.form-text.text-muted 0 = deterministic, 2 = creative

              .row
                .col-md-6
                  .mb-3
                    label.form-label Base URL
                    input.form-control(type="text" id="baseUrl" readonly)
                    small.form-text.text-muted Automatically set based on provider

              .d-flex.gap-2
                button.btn.btn-primary(type="submit")#saveProviderConfig
                  i.fas.fa-save.me-2
                  | Save Provider Configuration
                button.btn.btn-outline-secondary(type="button")#testProviderConfig
                  i.fas.fa-vial.me-2
                  | Test Configuration
                button.btn.btn-outline-info(type="button")#testArticleGeneration
                  i.fas.fa-file-alt.me-2
                  | Test Article Generation
                button.btn.btn-outline-info(type="button")#testImageGeneration
                  i.fas.fa-image.me-2
                  | Test Image Generation

        // Migration Guide Card
        .card.mb-4
          .card-header
            h5.mb-0 Provider Comparison & Migration
          .card-body
            .table-responsive
              table.table.table-sm.table-bordered
                thead.table-light
                  tr
                    th Feature
                    th OpenAI
                    th Novita AI
                tbody
                  tr
                    td Article Models
                    td GPT-4, GPT-4 Turbo, GPT-3.5
                    td DeepSeek, Llama, Mistral
                  tr
                    td Image Models
                    td DALL-E 3, DALL-E 2
                    td DALL-E 3 (compatible)
                  tr
                    td Cost
                    td Premium
                    td Budget-friendly
                  tr
                    td Speed
                    td Moderate
                    td Fast
                  tr
                    td Quality
                    td Highest
                    td Very Good
            
            .mt-3
              button.btn.btn-sm.btn-outline-primary(type="button")#switchProviderBtn
                i.fas.fa-exchange-alt.me-2
                | Switch Provider Guidance

        // Stripe Configuration Card
        .card
          .card-header
            h5.mb-0 Stripe Payment Configuration
          .card-body
            form#stripeConfigForm
              .alert.alert-info
                i.fas.fa-info-circle.me-2
                | Stripe keys are required for payment processing. Get your keys from 
                a(href="https://dashboard.stripe.com/apikeys" target="_blank") Stripe Dashboard
              
              .row
                .col-md-6
                  .mb-3
                    label.form-label(for="stripePublishableKey")
                      | Publishable Key
                      span.text-danger *
                    input.form-control(type="text" id="stripePublishableKey" placeholder="pk_live_..." required)
                    small.form-text.text-muted
                      | Used for frontend Stripe.js checkout

                .col-md-6
                  .mb-3
                    label.form-label(for="stripeSecretKey")
                      | Secret Key
                      span.text-danger *
                    input.form-control(type="password" id="stripeSecretKey" placeholder="sk_live_..." required)
                    small.form-text.text-muted
                      | Used for backend payment processing

              .row
                .col-md-6
                  .mb-3
                    label.form-label(for="stripeWebhookSecret")
                      | Webhook Secret
                      span.text-danger *
                    input.form-control(type="password" id="stripeWebhookSecret" placeholder="whsec_..." required)
                    small.form-text.text-muted
                      | Used to verify Stripe webhook events

                .col-md-6
                  .mb-3
                    label.form-label(for="defaultCurrency") Default Currency
                    select.form-select#defaultCurrency
                      option(value="jpy") JPY (Japanese Yen)
                      option(value="usd") USD (US Dollar)
                      option(value="eur") EUR (Euro)
                      option(value="gbp") GBP (British Pound)

              .row
                .col-md-6
                  .mb-3
                    label.form-label(for="stripeMode") Operating Mode
                    select.form-select#stripeMode
                      option(value="test") Test Mode (Testing with test cards)
                      option(value="live") Live Mode (Real transactions)
                    small.form-text.text-warning.d-block.mt-2
                      i.fas.fa-exclamation-triangle.me-1
                      | Be careful when switching to Live Mode

                .col-md-6
                  .mb-3
                    label.form-label(for="stripeFeePercentage") Platform Fee (%)
                    input.form-control(type="number" id="stripeFeePercentage" min="0" max="100" step="0.1" value="0" placeholder="0-100")
                    small.form-text.text-muted
                      | Percentage fee to add to each transaction

              .d-flex.gap-2
                button.btn.btn-primary(type="submit")
                  i.fas.fa-save.me-2
                  | Save Stripe Configuration
                button.btn.btn-outline-secondary(type="button")#testStripeConnection
                  i.fas.fa-vial.me-2
                  | Test Connection
                button.btn.btn-outline-info(type="button")#viewStripeWebhooks
                  i.fas.fa-webhook.me-2
                  | View Webhooks

      // Analytics Tab
      .tab-pane.fade#analytics
        .row
          .col-md-6
            .card
              .card-header
                h6.mb-0 Recent Activity
              .card-body#recentActivity
                p.text-center Loading...
          .col-md-6
            .card
              .card-header
                h6.mb-0 Top Sites (Last 7 Days)
              .card-body#topSites
                p.text-center Loading...
        .row.mt-4
          .col-12
            .card
              .card-header
                h6.mb-0 Generation Trends
              .card-body
                canvas#generationChart(height="100")

  // Modals
  include modals/package-modal
  include modals/user-credits-modal
  include modals/site-details-modal
  include modals/seed-data-modal

  // JavaScript
  script(src="/js/external-dashboard.js")